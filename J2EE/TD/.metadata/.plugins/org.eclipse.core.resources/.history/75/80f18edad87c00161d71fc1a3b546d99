package servlet;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.sql.DataSource;

import sResultSet.SerializedResultSet;

	public class ServletTetris extends HttpServlet {
		Connection BD;
		DataSource ds;
		
		protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
			try {
				BD=ds.getConnection();
				Statement s = BD.createStatement();
				ResultSet r = s.executeQuery("select * from score");
				r.close();
				s.close();
				BD.close();
				s = null;
				r = null;
			} catch (java.sql.SQLException ex) {
				System.out.println("Erreur d'exécution de la requête SQL \n"+ex);
			}
		}

		
		
		public void init() throws ServletException {
			try {
				Context initCtx = new InitialContext();
				System.out.println("lookup de env");
				Context envCtx = (Context) initCtx.lookup("java:comp/env");
				System.out.println("lookup de Tetris");
				ds=(DataSource) envCtx.lookup("tetris");
			}
			catch(Exception er) {
				System.out.println("Erreur de chargement du contexte " + er);
			}
		}
	}
